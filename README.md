# Delta Service
The delta service can essentially be put in front of any SPARQL endpoint and will proxy calls to it. Then interested parties can subscribe to different forms of notifications about changes in the SPARQL endpoint.

## To be done
* make the updates sequential
* improve the internal triple model (it's a mess now)
* make certain thing configurable (enpdoints, authorization, ...)
* sort out the update notification format

## Configuring
[needs to be implemented]

## Notifications
To subscribe for notifications you can send a http request to the "/registerForPotentialDifferences" or the "/registerForEffectiveDifferences" route. The target of the callback should be identified in the body as follows:
```
{
"callback":"http://localhost:3000/print"
}
```

The callbacks will be notified with a HTTP request that has a body like this:
```
[{"graph":"http://graph1","delta":{"inserts":[{"o":"object","p":"predicate","s":"subject"}], "deletes":[]}}]
```

## Different types of notifications
### Effective differences
Those are triples that are really added to the datastore, these will always be a subset of the 'potential differences' for the same query.
To register for it you can send a request to the "/registerForEffectiveDifferences" route.
### Potential differences
These are the inserts and delete generated by a certain query. However if a triple would be inserted that is already in the SPARQL store or a triple would be deleted that is not in the SPARQL store then these changes do not *effectively* change the SPARQL endpoint.
For instance the first time the following query would be executed:
```
with <http://graph1>
insert
{
<http://uri1> <http://predicate1> <http://object1>
}
```
It is not unlikely that the effective and potential delta for this operation would be:
```
{"graph":"http://graph1", "delta":{"inserts":[{"s":"http://uri1","p":"http://predicate1","o":"http://object1"}],"deletes":[]}
```
The second time this query is executed however (unless someone deletes the above triple of course) the potential differences are still:
```
{"graph":"http://graph1", "delta":{"inserts":[{"s":"http://uri1","p":"http://predicate1","o":"http://object1"}],"deletes":[]}
```
but the effective differences would be:
```
{"graph":"http://graph1", "delta":{"inserts":[],"deletes":[]}
```
To register you can send a HTTP request to the "/registerForPotentialDifferences" route.
